# SELinux  

## Create and install SELinux policy package files  

### Tree diagram of the files that will be created  

The files are placed under the current directory at the time of execution as follows.  

``` bash:
./tmp/rule/
|-- custom_NetworkManager.fc
|-- custom_NetworkManager.if
|-- custom_NetworkManager.pp
|-- custom_NetworkManager.sh
|-- custom_NetworkManager.te
|-- custom_NetworkManager_selinux.spec
|-- custom_accountsd ...
|-- custom_colord ...
|-- custom_devicekit_disk ...
|-- custom_dnsmasq ...
|-- custom_firewalld ...
|-- custom_fwupd ...
|-- custom_getty ...
|-- custom_httpd ...
|-- custom_initrc ...
|-- custom_kmod ...
|-- custom_low_mem_mon ...
|-- custom_mount ...
|-- custom_semanage ...
|-- custom_smbd ...
|-- custom_sshd ...
|-- custom_switcheroo ...
|-- custom_system_dbusd ...
|-- custom_systemd_generator ...
|-- custom_systemd_journal_init ...
|-- custom_systemd_logind ...
|-- custom_systemd_resolved ...
|-- custom_systemd_tmpfiles ...
|-- custom_systemd_user_runtime_dir ...
|-- custom_udev ...
|-- custom_unconfined ...
|-- custom_useradd ...
|-- custom_vmware_tools ...
|-- custom_winbind ...
|-- custom_xdm ...
`-- tmp
```

### Packages required to run  

``` bash:
apt-get install -y selinux-basics selinux-policy-default auditd rpm
```

### Executing a shell  

By executing this shell, a package policy file will be created and installed.  

* link: [mk_rule.sh](./mk_rule.sh)

``` bash:
sudo ./mk_rule.sh
```

Create the following command and any recurring rules you need.

``` bash:
sudo bash -c 'ausearch --start MM/DD/YY hh:mm:ss | audit2allow -a -M test_rule'
cat test_rule.te
```

#### Runtime logs  

``` bash:
mk_rule.sh:     start   : NetworkManager_t
Compiling default custom_NetworkManager module
Creating default custom_NetworkManager.pp policy package
mk_rule.sh:     complete: NetworkManager_t
(omission)
mk_rule.sh:     start   : install modules
libsemanage.add_user: user sddm not in password file
mk_rule.sh:     complete: install modules
```

### SELinux policy package files installation tree diagram

#### for debian

``` bash:
/var/lib/selinux/default/active/modules/400/
|-- custom_NetworkManager
|   |-- cil
|   |-- hll
|   `-- lang_ext
|-- custom_accountsd ...
|-- custom_colord ...
|-- custom_devicekit_disk ...
|-- custom_dnsmasq ...
|-- custom_firewalld ...
|-- custom_fwupd ...
|-- custom_getty ...
|-- custom_httpd ...
|-- custom_initrc ...
|-- custom_kmod ...
|-- custom_low_mem_mon ...
|-- custom_mount ...
|-- custom_semanage ...
|-- custom_smbd ...
|-- custom_sshd ...
|-- custom_switcheroo ...
|-- custom_system_dbusd ...
|-- custom_systemd_generator ...
|-- custom_systemd_journal_init ...
|-- custom_systemd_logind ...
|-- custom_systemd_resolved ...
|-- custom_systemd_tmpfiles ...
|-- custom_systemd_user_runtime_dir ...
|-- custom_udev ...
|-- custom_unconfined ...
|-- custom_useradd ...
|-- custom_vmware_tools ...
|-- custom_winbind ...
`-- custom_xdm ...
```
