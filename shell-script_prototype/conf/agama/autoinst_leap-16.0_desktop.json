{
  "localization": {
    "language": "ja_JP.UTF-8",
    "keyboard": "jp",
    "timezone": "Asia/Tokyo"
  },
  "product": {
    "id": "openSUSE_Leap"
  },
  "root": {
    "password": "r00t"
  },
  "user": {
    "userName": "master",
    "fullName": "Master",
    "password": "master"
  },
  "scripts": {
    "pre": [
      {
        "name": "zzz_pre.sh",
        "content": |||
          #!/bin/sh
          _COMD_LINE="$(cat /proc/cmdline || true)"
          for __LINE in ${_COMD_LINE:-}
          do
            case "${__LINE}" in
              debug=*   ) debug="${__LINE#debug=}"   ; export debug;;
              debugout=*) debugout="${__LINE#debug=}"; export debugout;;
              *) ;;
            esac
          done
          mkdir -p /var/admin/autoinst/
          {
            if [ -n "${debug:-}" ] || [ -n "${debugout:-}" ]; then
              set -x
              export -p
            fi
            _FILE_SEED=""
            _COMD_LINE="$(cat /proc/cmdline || true)"
            for __LINE in ${_COMD_LINE:-}
            do
              case "${__LINE}" in
                preseed/url=*  | url=*  ) _FILE_SEED="${__LINE#*url=}";;
                preseed/file=* | file=* ) _FILE_SEED="${__LINE#*file=}";;
                ds=nocloud*             ) _FILE_SEED="${__LINE#*ds=nocloud*=}";_FILE_SEED="${_FILE_SEED%%/}/user-data";;
                inst.ks=*               ) _FILE_SEED="${__LINE#*inst.ks=}";;
                autoyast=*              ) _FILE_SEED="${__LINE#*autoyast=}";;
                inst.auto=*             ) _FILE_SEED="${__LINE#*inst.auto=}";;
                *) ;;
              esac
            done
            __DIRS="${_FILE_SEED%/user-data}"
            __DIRS="${__DIRS%/*/*}"
            __DIRS="${__DIRS%%/}"
            cd /var/admin/autoinst/ || exit 1
            echo "download/copy: [${__DIRS:-}]"
            case "${__DIRS:-}" in
              http:*|https:*|ftp:*|tftp:*) curl -L -# -O -R -S "${__DIRS:-}/script/autoinst_cmd_early.sh";;
              nfs:*                      ) ;;
              hd:sr0:*|cdrom|cdrom:*     ) cp -p "/mnt/install/repo/${__DIRS#*:/}/script/autoinst_cmd_early.sh" ./;;
              hd:*                       ) ;;
              hmc                        ) ;;
              file:*|/*                  ) cp -p "${__DIRS#*:*//}/script/autoinst_cmd_early.sh" ./;;
              *) ;;
            esac
            chmod +x ./autoinst_cmd_early.sh
            ./autoinst_cmd_early.sh
          } >> /var/admin/autoinst/autoinst_cmd_early.sh.log 2>&1
          exit 0
        |||
      }
    ],
    "postPartitioning": [
      {
        "name": "zzz_postpartitioning.sh",
        "content": |||
          #!/bin/sh
          _COMD_LINE="$(cat /proc/cmdline || true)"
          for __LINE in ${_COMD_LINE:-}
          do
            case "${__LINE}" in
              debug=*   ) debug="${__LINE#debug=}"   ; export debug;;
              debugout=*) debugout="${__LINE#debug=}"; export debugout;;
              *) ;;
            esac
          done
          {
            if [ -n "${debug:-}" ] || [ -n "${debugout:-}" ]; then
              set -x
              export -p
            fi
            cd /var/admin/autoinst/
            ./autoinst_cmd_part.sh
          } >> /var/admin/autoinst/autoinst_cmd_part.sh.log 2>&1
          exit 0
        |||
      }
    ],
    "post": [
      {
        "name": "zzz_post.sh",
        "chroot": false,
        "content": |||
          #!/bin/sh
          _COMD_LINE="$(cat /proc/cmdline || true)"
          for __LINE in ${_COMD_LINE:-}
          do
            case "${__LINE}" in
              debug=*   ) debug="${__LINE#debug=}"   ; export debug;;
              debugout=*) debugout="${__LINE#debug=}"; export debugout;;
              *) ;;
            esac
          done
          {
            if [ -n "${debug:-}" ] || [ -n "${debugout:-}" ]; then
              set -x
              export -p
            fi
            mkdir -p /mnt/var/admin/
            mount --bind /var/admin/ /mnt/var/admin/
            chroot /mnt/ /var/admin/autoinst/autoinst_cmd_late.sh || true
            umount /mnt/var/admin/ || umount -f /mnt/var/admin/ || umount -l /mnt/var/admin/ || true
          } >> /var/admin/autoinst/autoinst_cmd_late.sh.log 2>&1
          [ -d /mnt/var/admin/. ] && cp -pr /var/admin/* /mnt/var/admin/
          exit 0
        |||
      }
    ],
    "init": [
      {
        "name": "zzz_init.sh",
        "content": |||
          #!/bin/sh
          _COMD_LINE="$(cat /proc/cmdline || true)"
          for __LINE in ${_COMD_LINE:-}
          do
            case "${__LINE}" in
              debug=*   ) debug="${__LINE#debug=}"   ; export debug;;
              debugout=*) debugout="${__LINE#debug=}"; export debugout;;
              *) ;;
            esac
          done
          {
            if [ -n "${debug:-}" ] || [ -n "${debugout:-}" ]; then
              set -x
              export -p
            fi
            cd /var/admin/autoinst/
            ./autoinst_cmd_run.sh
          } >> /var/admin/autoinst/autoinst_cmd_run.sh.log 2>&1
          [ -d /mnt/var/admin/. ] && cp -pr /var/admin/* /mnt/var/admin/
          exit 0
        |||
      }
    ]
  },
  "software": {
    "patterns": [
      "gnome",
      "base",
      "documentation",
      "enhanced_base",
      "minimal_base"
    ],
    "packages": [
      "rhythmbox",
      "lvm2",
      "selinux-policy-targeted",
      "sudo",
      "firewalld",
      "traceroute",
      "NetworkManager",
      "ShellCheck",
      "bash-completion",
      "curl",
      "vim",
      "bc",
      "rsync",
      "tree",
      "openssh-server",
      "systemd-resolved",
      "dnsmasq",
      "tftp",
      "bind-utils",
      "apache2",
      "samba",
      "samba-client",
      "cifs-utils",
      "samba-winbind",
      "open-vm-tools",
      "open-vm-tools-desktop",
      "fuse",
      "glibc-i18ndata",
      "glibc-locale",
      "less",
      "wget",
      "which",
      "zypper"
    ]
  },
  "storage": {
    "drives": [
      {
        "search": {
          "condition": {
            "name": "/dev/nvme0n1"
          },
          "ifNotFound": "error"
        },
        "alias": "pvs-disk",
        "partitions": [
          {
            "search": {
              "ifNotFound": "skip"
            },
            "delete": true
          }
        ]
      }
    ],
    "volumeGroups": [
      {
        "name": "system",
        "physicalVolumes": [
          { "generate": [ "pvs-disk" ] }
        ],
        "logicalVolumes": [
          {
            "filesystem": {
              "path": "/",
              "type": "btrfs"
            },
            "name": "root"
          },
          {
            "filesystem": {
              "path": "swap",
              "type": "swap"
            },
            "name": "swap"
          }
        ]
      }
    ]
  }
}
